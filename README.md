# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Используемые данные

### Интерфейсы

Данные, получаемые с сервера

```
interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: ProductType;
  price: number | null;
}
```

Интерфейс карточки товара

```
interface ICard {
  id: string;
  description: string;
  image: string;
  title: string;
  category: ProductType;
  price: number | null;
  inBasket: boolean;
}
```

Интерфейс главной страницы

```
interface IPage {
  catalog: HTMLElement[];
  orderCounter: number;
  locked: boolean;
}
```

Список товаров в корзине и их общую стоимость

```
interface IBasket {
  orderList: string[];
  totalPrice: number;
}
```

Поля для оформления заказа

```
interface IOrder {
  payment: PaymentType;
  address: string;
  email: string;
  phoneNumber: string;
  orderList: string[];
  totalPrice: number;
}
```

Подтверждение заказа

```
interface IOrderConfirmation {
  totalPrice: number;
}
```

Интерфейс получения данных с сервера

```
interface IProjectApi {
  getCards: () => Promise<IProduct[]>;
  getCard: (id: string) => Promise<IProduct>;
  orderConfirm: (order: IOrder) => Promise<IOrderConfirmation>;
}
```

### Типы данных

Категория товара

```
type ProductType =
  | 'хард-скил'
  | 'софт-скил'
  | 'дополнительное'
  | 'кнопка'
  | 'другое';
```

Тип для проверки данных пользователя

```
type OrderForm = Omit<IOrder, 'orderList' | 'totalPrice'>;
```

Метод оплаты

```
type PaymentType = 'online' | 'cash';
```

## Архитектура проекта

Проект выполнен в парадигме MVP,
присутствуют 3 главных раздела:  
```
1) Model - содержит и обрабатывает данные
2) View - отображает данные, принимает команды пользователя
3) Presenter - связующий элемент, получает команды от View, обрабатывает, передает обновленную информацию Model. Получает требуемую информацию от Model и использует View для ее отрисовки.
```


### Базовые классы

#### Класс API

```
Класс для работы с API. Обладает стандартными методами запросов к серверу и обработки ответов.  

constructor(baseUrl: string, options: RequestInit = {}) - принимает URL и настройки запросов  
  
Вшитые методы - get и post, обращаются к серверу чтобы получить/передать данные с сервера/на сервер 
```

#### EventEmitter

```
Брокер событий, позволяет подписываться, отписываться и запускать срабатывание событий.
  
constructor() {
        this._events = new Map<EventName, Set<Subscriber>>();
    } - принимает набор событий и их подписчиков в формате пар ключ-значение.  
```
Вшитые методы:  
- on - включает событие
- of - выключает событие
- emit - запускает выполнение события с переданными данными (опционально)
- onAll - запускает прослушку всех событий
- ofAll - снимает прослушку со всех событий



#### Component<T>

```
Базовый класс, предназначенный для работы с DOM - элементами. Получает на вход HTML контейнер и связывается с брокером событий через IEvents:  
  
constructor(protected readonly element: HTMLElement, protected readonly events: IEvents)  
```
Обладает следующими методами изменения контента внутри HTML-элементов:  
- toggleClass - переключает нужный класс у нужного элемента
- changeDisabled -  в зависимости от полученного значения убирает/добавляет элементу атрибут disabled
- addImage/addText - добавляют в указанный элемент переданные текст/изображение
- elementUpdate - принимает данные (опционально) и обновляет на их основе HTML элемент объекта, после чего возвращает его.


#### Model

```
Класс, хранящий данные и управляющий ими. Содержит данные о продуктах, содержимом корзины, платежных данных, введенных пользователем.
  
constructor(protected events: IEvents) - связывается через конструктор с брокером событий.
```
Обладает обширным набором методов для сохранения и обработки данных:
- setItems - обновляет список товаров, запускает событие заполнения каталога.
- openCard - запоминает октрытую карточку.
- checkBasket - проверяет наличие товара в корзине по его id
- addInBasket - добавляет товар в корзину, обновляет общую цену покупок.
- removeFromBasket - убирает товар из корзины и обновляет общую стоимость покупок.
- clearBasket - очищает корзину, сбрасывает общую стоимость товаров
- setPaymentMethod - устанавливает выбранный способ оплаты заказа
- checkOrder - проверяет введенные пользователем данные, запускает событие изменения отображения ошибок в форме заказа

### Производные классы

#### ProjectApi

```
Наследует класс API по интерфейсу IProjectApi.  
constructor(cdn: string, baseUrl: string, options?: RequestInit) - конструктор как и родительский класс принимает базовый URL-адрес т опциональные настройки, а также CDN. Класс нужен для удобной работы с запросами к серверу.
```
Содержит следующие методы:
- getCard - возвращает одну карточку по ее id и в возвращаемых данных формирует ссылку на ее изображение
- getCards - выгружает данные о всех карточках товаров и формирует ссылку на изображение для каждой карточки.
- orderConfirm - отправляет на сервер запрос на подтверждение заказа и возвращает ответ.

#### Modal

```
Класс для отрисовки модальных окон и управления их содержимым. Наследует Component по интерфейсу <IModal>. 
constructor(element: HTMLElement, events: IEvents) - класс получает на входе контейнер модального окна и набор событий. 
```
Поля и методы класса:
- protected _content: HTMLElement - текущее содержимое модалки
- protected _button: HTMLButtonElement - кнопка для закрытия окна
- set content - принмает HTML контейнер и заменяет им содержимое модального окна
- openModal - добавляет окну статус "активного" и активирует событие modal:open
- closeModal - убирает статус и модального окна и запускает событие modal:close

#### Form

```
Класс для управления формой, ее содержимым и отображения ошибок, наследует Component по интерфейсу IForm.
constructor(element: HTMLFormElement, events: IEvents) - принимает HTMLForm-элемент для отображения формы и связывается с брокером событий.
```
Поля класса:
- protected _submitButton: HTMLButtonElement - кнопка подтверждения данных
- protected _errorList: HTMLElement - элемент для вывода ошибок
Методы класса:
- inputUpdate(input: keyof T, value: string) - принимает форму, где были введены новые данные, запускает событие, изменяющее нужное значение в форме
- set errorList - меняет текст ошибки
- set isValid - включает/отключает кнопку подтверждения заказа
- elementUpdate(data: Partial<T> & IForm): HTMLElement - перегруженный метод из родительского класса, адаптирующий его под работу с формой, принимает объект, содержащий некоторые свойства формы. Также обновляет компонент объекта полученными данными и возвращает обновленный элемент.

#### Order

```
Класс Order наследует Form по типу OrderForm. Создан для реализации форм с выбором формы оплаты и вводом контактных данных покупателя.  
constructor(element: HTMLFormElement, events: IEvents) - конструктор как обычно принимает HTMLForm контейнер и набор событий events. 
```
Содержимое класса:
- protected _cardMethod: HTMLButtonElement - кнопка оплаты картой
- protected _cashMethod: HTMLButtonElement - кнопка оплаты наличкой
- set payment - устанавливает нужный метод оплаты и включает соответствующую кнопку
- set address - устанавливает адрес доставки
- set email - устанавливает адрес почты
- set phoneNumber - устанавливает номер телефона

#### Basket

```
Наследует Component по интерфейсу IBasket. Класс создан для управления и отображения корзины, управления списком товаров и кнопкой оформления заказа.  
constructor(element: HTMLElement, events: IEvents) - принимает HTML контейнер корзины и набор событий events. Здесь вызывается событие, открывающее форму оплаты заказа при нажатии на активную кнопку оформления заказа.
```
Поля:
- protected _orderList: HTMLElement - содержимое корзины.
- protected _totalPrice: HTMLElement - общая стоимость товаров в корзине
- protected _confirmButton: HTMLElement - кнопка оформления заказа
Методы:
- manageButton(value: number) - в заисимости от полученного числа включает либо отключает кнопку оформления заказа

#### Confirmation

```
Класс для окна подтверждения покупки, наследует Form по интерфейсу IOrderConfirmation.
constructor(element: HTMLElement, events: IEvents) - принимает HTMLForm контейнер и набор событий events.
При получении положительного ответа от сервера сообщает списанную сумму и сообщает об успешном завершении заказа.
```

#### Card

```
Класс для отображения карточки товара и взаимодействия с ней, наследует Component по интерфейсу ICard.
constructor(element: HTMLElement, events: IEvents) - принимает компонент карточки и связывается с брокером событий. Здесь запускаются события card:open при нажатии на карточку и basket:change при добавлении или убирании товара в/из корзины.
```
Содержиое:
- protected _description?: HTMLElement - элемент с описанием товара
  protected _image?: HTMLImageElement - картинка товара
  protected _title: HTMLElement - заголовок
  protected _category?: HTMLElement категория товара
  protected _price: HTMLElement - цена товара
  protected _inBasket: boolean - показывает наличие товара в корзине
  protected _button: HTMLButtonElement - кнопка добавить/убрать товар
  private item?: ICard - корневой элемент карточки

#### Page

```
Класс для управления главной страницей магазина и ее элементами, наследует Component по интерфейсу IPage
constructor(element: HTMLElement, events: IEvents) - получаем контейнер страницы и набор событий.
```
Поля:
- protected _counter: HTMLElement - счетик товаров в корзине
- protected _catalog: HTMLElement - содержимое каталога товаров
- protected _basketButton: HTMLElement - кнопка корзины
- protected _pageWrapper: HTMLElement - внешний контейнер, блокирующийся при открытии модального окна.

## События
Работа с каталогом:
- catalog:fill - срабатывает при изменении списка товаров, создает новый массив карточек.  

Работа с модальными окнами:
- card:open - вызывается при нажатии на карточку, отрисовывает новый шалон карточки, устанавливает текст на кнопке исходя из того, добавлена карточка в корзину или нет, открывает модальное окно.
- modal:open - блокирует прокрутку страницы, вызывается при открытии модального окна.
- modal:close - ращблокирует прокрутку страницы, вызывается при закрытии модального окна.  

Работа с корзиной:
- basket:open - вызывается при нажатии на кнопку корзины, отрисовывает содержимое модального окна, передавая туда контейнер корзины и открывает его. Включает/выключает кнопку оформления заказа исходя из наличия товаров внутри.
- basket:change - активируется при добавлении/удалении товаров из корзины. Проверяет наличие товара в заказе по его id, добавляет либо убирает его карточку из корзины и обновляет сумму заказа. Управляет нумерацией товаров в корзине.  

Работа с формами
- order:open - вызывается при нажатии на кнопку оформления заказа. Отрисовывает форму, блокирует кнопку, открывает модальное окно.
- ...:change - одинаковый функционал для разных полей формы, срабатывает при изменении соответствующего значения, изменяет содержимое соответствующего поля.
- errors:change - вызывается после валидации изменившихся данных пользователядля обновления информации об имеющихся ошибках заполнения форм
- order:submit - вызывается при нажатии кнопки подтверждения формы оплаты для перехода к форме с контактами. Обновляет содержимое формы и открывает модальное окно.
- order:confirm - вызывается при нажатии кнопки после ввода контактной информации, отправляет запрос на сервер. При получении подтверждения от сервера отрисовывает окно с сообщением о завершении покупки и открывает модальное окно. Очищает корзину.